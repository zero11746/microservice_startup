# Go 微服务启动代码

初学者，为了学习写的一个微服务启动代码，代码可能不严谨，欢迎大家补充和完

这是一个基于 Go 语言构建的微服务基础设施启动程序，采用 gRPC 进行服务间通信，提供了一套完整的微服务运行时所需的基础设施组件初始化与管理方案。

## 项目架构

本项目采用微服务架构，主要包含以下服务模块：

- **API 网关服务** (`api/`) - 提供 HTTP 接口，处理业务逻辑和路由分发
- **用户服务** (`user/`) - 核心用户管理微服务，提供 gRPC 接口

## 核心功能

### 1. 多数据源支持
- **MySQL** - 关系型数据存储，支持读写分离配置
- **Redis** - 高性能缓存，提供连接池管理
- **MongoDB** - 文档型数据库，支持连接池和认证

### 2. 分布式追踪
- 集成 **Jaeger** 分布式链路追踪系统
- 提供完整的请求链路追踪能力

### 3. 日志系统
- 结构化日志输出
- 支持日志级别配置
- 集成 **Elasticsearch** 日志收集
- 支持日志按时间分割和保留策略

### 4. 服务发现
- 集成 **etcd** 服务注册与发现
- 支持服务健康检查和负载均衡

### 5. gRPC 框架
- 基于 gRPC 的服务间通信
- 服务注册与发现机制
- 拦截器和中间件支持

## 项目结构

```
microservice_startup/
├── api/                    # API 网关服务
│   ├── config/            # API 服务配置
│   ├── grpc/              # gRPC 客户端相关
│   ├── handler/           # HTTP 请求处理器
│   ├── router/            # HTTP 路由配置
│   ├── web/               # Web 服务启动
│   └── main.go            # API 服务入口
├── common/                 # 公共组件库
│   ├── applog/            # 日志组件
│   ├── discovery/         # 服务发现组件
│   ├── env/               # 环境配置
│   ├── errs/              # 错误处理
│   ├── es/                # Elasticsearch 组件
│   ├── httputils/         # HTTP 工具
│   ├── jwtutils/          # JWT 认证工具
│   ├── tracer/            # 链路追踪组件
│   └── run.go             # 服务运行管理
├── user/                   # 用户微服务
│   ├── config/            # 用户服务配置
│   ├── internal/          # 内部实现（包括 Ent ORM 模型）
│   ├── pkg/               # 用户服务包
│   │   ├── constants/     # 常量定义
│   │   ├── database/      # 数据库操作
│   │   ├── errors/        # 错误定义
│   │   ├── grpc/          # gRPC 相关
│   │   ├── initialize/    # 初始化组件
│   │   ├── kafka/         # Kafka 消息队列
│   │   ├── mongodbutils/  # MongoDB 工具
│   │   └── redisutils/    # Redis 工具
│   ├── proto/             # gRPC 协议定义
│   └── main.go            # 用户服务入口
└── README.md              # 项目说明
```

## 快速开始

### 环境要求

- Go 1.19+
- MySQL 5.7+
- Redis 6.0+
- MongoDB 4.0+
- etcd 3.4+
- Jaeger 1.0+

### 配置说明

所有服务配置均通过 `config.toml` 文件管理，支持以下配置项：

- 服务基本信息（名称、环境、端口等）
- 数据库连接配置（MySQL、Redis、MongoDB）
- 日志配置（输出路径、级别、格式等）
- 分布式追踪配置（Jaeger）
- 服务发现配置（etcd）

### 启动服务

1. **启动用户服务**:
   ```bash
   cd user
   go run main.go
   ```

2. **启动 API 网关**:
   ```bash
   cd api
   go run main.go
   ```

## 技术栈

- **语言**: Go 语言
- **Web 框架**: Gin (API 网关)
- **RPC 框架**: gRPC
- **数据库**: MySQL, MongoDB
- **缓存**: Redis
- **服务发现**: etcd
- **链路追踪**: Jaeger
- **日志系统**: 自定义日志组件，支持输出到 Elasticsearch
- **ORM**: Ent (用于数据库操作)

## 特性

- **高可用性**: 通过服务发现和负载均衡实现高可用
- **可扩展性**: 模块化设计，易于扩展新功能
- **可观测性**: 完整的监控、日志和链路追踪
- **配置管理**: 支持多种环境配置管理
- **错误处理**: 统一的错误处理机制
- **优雅关闭**: 支持服务的优雅启动和关闭

## 使用场景

此框架适用于需要构建复杂微服务架构的场景，特别适合：
- 需要多种数据存储方案的系统
- 需要分布式追踪的微服务架构
- 需要集中日志管理的系统
- 需要服务注册与发现的分布式系统


## 作者：qq:2451461804
## 欢迎大家提出建议和完善代码